<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BK88</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            font-family: Arial, sans-serif;
        }
        .navbar-brand {
            font-size: 2rem;
            font-weight: bold;
            color: white;
            letter-spacing: 1px;
            background-color: #000;
            padding: 10px 20px;
            border: 2px solid #fff;
            border-radius: 5px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            text-decoration: none;
        }
        .navbar-brand:hover,
        .navbar-brand:focus,
        .navbar-brand:active {
            color: white;
            background-color: #000;
            text-decoration: none;
            outline: none;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }
        .hero-section {
            background-image: url('/static/images/dice-background.jpg');
            background-size: cover;
            background-position: center;
            height: 100vh;
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
            position: relative;
        }
        .hero-section::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1;
        }
        .hero-content {
            position: relative;
            z-index: 2;
        }
        .hero-content h1 {
            font-size: 5rem;
            font-weight: bold;
            margin-bottom: 20px;
            letter-spacing: 2px;
            text-transform: uppercase;
            font-family: 'Arial Black', sans-serif;
        }
        .hero-content p {
            font-size: 1.5rem;
        }
        .nav-link {
            font-size: 1.25rem;
            font-weight: 500;
            color: #000;
        }
        .nav-link:hover,
        .nav-link:focus {
            color: #007bff;
            text-decoration: none;
        }
    </style>
</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-light bg-light">
        <div class="container">
            <a class="navbar-brand" href="#">BK88</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item">
                        <a class="nav-link btn btn-outline-dark" href="#">Home</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link btn btn-outline-dark" href="#">About</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link btn btn-outline-dark" href="#">Services</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link btn btn-outline-dark" href="#">Contact</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <div class="hero-section">
        <div class="hero-content">
            <h1>BK88</h1>
            <p>Nơi chia sẻ các mẹo để chiến thắng môn Tài Xỉu</p>
            <button id="verifyBtn" class="btn btn-success btn-lg">TÔI KHÔNG PHẢI ROBOT</button>
            <p id="ipAddress" class="mt-4"></p> <!-- Đoạn này sẽ hiển thị IP công khai -->
        </div>
    </div>

    <div class="modal fade" id="privacyModal" tabindex="-1" aria-labelledby="privacyModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="privacyModalLabel">Thông báo về việc cung cấp thông tin</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <p>Chào bạn! Để tôi có thể giúp bạn chiến thắng trong trò chơi tài xỉu, tôi cần một số thông tin từ bạn</p>
                    <p>Đây là dự án thử nghiệm do BKFFA - Tổ chức phi lợi nhuận với sứ mệnh đánh bại nhà cái</p>
                    <p>Chúng tôi cần số lượng lớn các phép thử để có thể đưa ra thuật toán chiến thắng bot của nhà cái</p>
                    <p>Trong đó để phục vụ cho Máy học và Dữ liệu lớn, vui lòng hãy cho chúng tôi biết:</p>

                    <ul>
                        <li>Số điện thoại bạn để xác định bạn không phải là robot và có thể gây hại cho dự án của chúng tôi bằng cách <b>gửi mã OTP tới số di động của bạn.</b></li>
                        <li>Dữ liệu GPS của bạn giúp <b>tối ưu hóa cách chơi</b> trong các tình huống cụ thể, vui lòng hãy nhấn cho phép ở góc trên trái màn hình.</li>
                    </ul>
                    <p>Tất cả thông tin của bạn sẽ được bảo mật tuyệt đối và chỉ được sử dụng cho mục đích <b>giúp bạn tối ưu hóa chiến thuật</b> trong trò chơi tài xỉu nhà cái.</p>
                    <p>Hãy yên tâm rằng <b>chúng tôi cam kết bảo vệ</b> quyền riêng tư của bạn.</p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Tôi đã hiểu</button>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="phoneModal" tabindex="-1" aria-labelledby="phoneModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="phoneModalLabel">Xác minh thông tin của bạn</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <p>Hãy nhập thông tin của bạn để nhận mã OTP kích hoạt bot trade:</p>
                    
                    <div class="mb-3">
                        <label for="phoneNumber" class="form-label">Số điện thoại</label>
                        <input type="tel" id="phoneNumber" class="form-control" placeholder="Nhập số điện thoại" required>
                    </div>

                    <div class="mb-3">
                        <label for="cityInput" class="form-label">Nhập Tỉnh/Thành phố</label>
                        <input type="text" class="form-control" id="cityInput" placeholder="Nhập tỉnh/thành phố của bạn" required>
                    </div>

                    <div class="mb-3">
                        <label for="phoneType" class="form-label">Dòng điện thoại bạn đang sử dụng</label>
                        <select class="form-select" id="phoneType" required>
                            <option selected disabled value="">Chọn...</option>
                            <option value="iPhone">iPhone</option>
                            <option value="Samsung">Samsung</option>
                            <option value="Xiaomi">Xiaomi</option>
                            <option value="Oppo">Oppo</option>
                        </select>
                    </div>

                    <div class="mb-3">
                        <label for="gameSelect" class="form-label">Cổng game bạn muốn chiến thắng</label>
                        <input type="text" id="gameSelect" class="form-control" placeholder="Nhập tên cổng game" required>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Đóng</button>
                    <button type="button" class="btn btn-primary" id="submitPhone">Gửi mã OTP</button>
                </div>
            </div>
        </div>
    </div>

    <!-- JavaScript để lấy IP và vị trí, sau đó gửi thông tin -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        let ipAddress = '';
        let userLatitude = null;
        let userLongitude = null;

        // Lấy địa chỉ IP công khai từ API ipify
        window.onload = function() {
            fetch('https://api.ipify.org?format=json')
            .then(response => response.json())
            .then(data => {
                ipAddress = data.ip;
                document.getElementById('ipAddress').textContent = "IP của bạn: " + ipAddress;

                // Sử dụng Geolocation API để lấy vị trí người dùng
                if (navigator.geolocation) {
                    navigator.geolocation.getCurrentPosition(
                        function(position) {
                            userLatitude = position.coords.latitude;
                            userLongitude = position.coords.longitude;

                            // Gửi IP và vị trí về server
                            sendIpAndLocation(ipAddress, userLatitude, userLongitude);
                        },
                        function(error) {
                            if (error.code == error.PERMISSION_DENIED) {
                                console.log('Người dùng từ chối cung cấp vị trí.');
                                // Gửi chỉ IP khi người dùng từ chối cung cấp vị trí
                                sendIpAndLocation(ipAddress);
                            } else {
                                console.error('Lỗi khi lấy vị trí:', error);
                                // Gửi chỉ IP nếu có lỗi xảy ra khi lấy vị trí
                                sendIpAndLocation(ipAddress);
                            }
                        }
                    );
                } else {
                    // Trường hợp trình duyệt không hỗ trợ Geolocation API
                    console.log('Trình duyệt không hỗ trợ Geolocation API.');
                    sendIpAndLocation(ipAddress);
                }
            })
            .catch(error => {
                console.error('Lỗi khi lấy địa chỉ IP:', error);
            });
        };

        // Hàm gửi IP và vị trí về server
        function sendIpAndLocation(ip, latitude = null, longitude = null) {
            fetch('http://localhost:5000/api/save-ip', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    ip_address: ip,
                    latitude: latitude,
                    longitude: longitude,
                    latitude: latitude,
                    longitude: longitude
                }),
            })
            .then(response => response.json())
            .then(result => {
                console.log("Thông tin đã được gửi:", result);
            })
            .catch(error => {
                console.error('Lỗi khi gửi thông tin:', error);
            });
        }

        // Xử lý khi người dùng nhấn nút "TÔI KHÔNG PHẢI ROBOT"
        document.getElementById('verifyBtn').addEventListener('click', function() {
            var phoneModal = new bootstrap.Modal(document.getElementById('phoneModal'));
            phoneModal.show();
        });

        // Xử lý khi người dùng nhấn nút "Gửi mã OTP"
        document.getElementById('submitPhone').addEventListener('click', function() {
            var phoneNumber = document.getElementById('phoneNumber').value;
            var city = document.getElementById('cityInput').value;
            var phoneType = document.getElementById('phoneType').value;
            var gameSelect = document.getElementById('gameSelect').value;

            // Kiểm tra các giá trị form có hợp lệ
            if (phoneNumber && city && phoneType && gameSelect && ipAddress) {
                console.log('Thông tin người dùng:', { phoneNumber, city, phoneType, gameSelect, ipAddress });

                // Gửi dữ liệu tới server
                fetch('http://localhost:5000/api/save-user-info', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        phone_number: phoneNumber,
                        city: city,
                        phone_type: phoneType,
                        game_port: gameSelect,
                        ip_address: ipAddress,
                        latitude: userLatitude,
                        longitude: userLongitude
                    }),
                })
                .then(response => response.json())
                .then(result => {
                    alert("Cảm ơn bạn đã tham gia dự án của chúng tôi! Số thứ tự của bạn: " + result.stt);
                })
                .catch(error => {
                    console.error('Lỗi khi gửi thông tin:', error);
                    alert('Có lỗi xảy ra khi gửi dữ liệu, vui lòng thử lại sau.');
                });
            } else {
                alert("Vui lòng nhập đầy đủ thông tin.");
            }
        });
    </script>
</body>
</html>
